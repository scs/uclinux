#!/bin/bash
########################################################################################################################
######### To run this script, please first set following uboot varibles properly on your target board  #################
######### set  bootcmd   run tftpboot                                                                  #################
######### set  tftpboot  'tftp 0x1000000 linux;bootelf'                                                #################
######### set  ipaddr    10.100.4.50  (set your board ip here)                                         #################
######### set  serverip  10.100.4.174 (set your server ip here)                                        #################
########################################################################################################################

 ############### Set up the testing environment. Edit the following variables to suit your situation. ###################
 
 USER=/home/test/work/cruise
 BOARD_CONFIG=BF537-STAMP-STD
 CPU=BF537
 REVISION=0.2
 UCLINUX_DIST_PATH=$USER/checkouts/uclinux-dist
 BINARY_FORMAT=flat
 ALLOCATOR=slab\(p2\)
 ICACHE=on
 DCACHE=on
 POLICY=write_through
 UART_MODE=dma
 SMP=off
 MPU=off
 THIS_LOG="$USER/test_scripts/uclinux-dist/logs"
 
 
 ########################################### Please don't edit anything below this line.###################################

if [ $# -lt 1 ] ; then
  echo "Please input BOARD_CONFIG [ CPU REVISION UCLINUX_DIST_PATH BINARY_FORMAT ALLOCATOR ICACHE DCACHE POLICY UART_MODE SMP MPU THIS_LOG VCO_MULT CCLK_DIV SCLK_DIV ] values: "
  echo
  echo "The BOARD_CONFIG :  BF533-STAMP-STD, BF537-STAMP-STD, BF537-STAMP-IDE,etc."
  echo "The CPU :           BF533, BF537, BF561,etc."
  echo "The REVISION :      0.2, 0.3 ,etc."
  echo "The BINARY_FORMAT : flat, elf, shared-flat."
  echo "The ALLOCATOR :     slab\(p2\), slob\(p2\)."
  echo "The ICACHE,DCACHE : on, off."
  echo "The POLICY :        write_through, write_back."
  echo "The UART_MODE :     dma, pio."
  echo "The SMP,MPU :       on, off."
  echo "For example:./kernel_test BF537-STAMP-STD BF537 /home/test/work/cruise/checkouts/uclinux-dist flat slab\(p2\) on on write_through dma off off /home/test/work/cruise/test_scripts/uclinux-dist/logs."
  exit
fi

if [ $# -gt 0 ] ; then
  BOARD_CONFIG=$1
  echo  "##### Testing is done with: $BOARD_CONFIG."
fi

if [ $# -gt 1 ] ; then     
  CPU=$2
  echo "##### CPU: $CPU." 
fi

if [ $# -gt 2 ] ; then
  REVISION=$3
  echo "##### REVISION: $REVISION."
fi

  if [ $# -gt 3 ] ; then 
  UCLINUX_DIST_PATH=$4
  echo "##### UCLINUX_DIST_PATH: $UCLINUX_DIST_PATH."  
fi

  UCLINUX_DIST_PATH_BAK="$UCLINUX_DIST_PATH"".bak"  
  UCLINUX_DIST_SCRIPTS=$USER/test_scripts
  UCLINUX_DIST_TESTSUITES=$UCLINUX_DIST_PATH/testsuites  
  
if [ $# -gt 4 ] ; then
  BINARY_FORMAT=$5  
  echo "##### BINARY_FORMAT: $BINARY_FORMAT."
fi

if [ $# -gt 5 ] ; then
  ALLOCATOR=$6
  echo "##### ALLOCATOR: $ALLOCATOR."
fi
  
if [ $# -gt 6 ] ; then
  ICACHE=$7
  DCACHE=$8
  POLICY=$9  
  echo "##### ICACHE: $ICACHE, DCACHE: $DCACHE, POLICY is $POLICY." 
fi
  
if [ $# -gt 9 ] ; then
  UART_MODE=${10}
  echo "##### UART_MODE: $UART_MODE."
fi
  
if [ $# -gt 10 ] ; then
  SMP=${11}
  echo "##### SMP: $SMP."
fi

if [ $# -gt 11 ] ; then
  MPU=${12}
  echo "##### MPU: $MPU."
fi

if [ $# -gt 12 ] ; then
  THIS_LOG=${13}
  echo "##### Test results are in folder: $THIS_LOG."
fi
 
if [ $# -gt 13 ] ; then
  VCO_MULT=${14}
  CCLK_DIV=${15}
  SCLK_DIV=${16}
  echo "##### VCO_MULT: $VCO_MULT, CCLK_DIV: $CCLK_DIV, SCLK_DIV: $SCLK_DIV."
fi

echo "Testing on $BOARD_CONFIG ($CPU) $BINARY_FORMAT $ALLOCATOR ICACHE($ICACHE) DCACHE($DCACHE) $POLICY $UART_MODE SMP($SMP) MPU($MPU)"

###### See if uclinux-dist has been checked out.##################################################
 
if [ -d $UCLINUX_DIST_PATH_BAK ] ; then
  rm -rf $UCLINUX_DIST_PATH_BAK
fi
if [ ! -d $UCLINUX_DIST_PATH ] ; then
  exit 2
fi

if [ ! -d $THIS_LOG ] ; then
  mkdir -p $THIS_LOG    
else 
  rm -rf $THIS_LOG/*  
fi
  
### set this value to 1 if your target board could be restarted from host machine parallel port.

   RESET_BOARD=1 
   BUILD_POLICY=1
 
   n=100

   AUTO_TESTCASE=( [0]="serial"    [1]="ethernet"   [2]="ethernet_in_buffer"  [3]="stress"  [4]="nfs"  [5]="ramfs"  [6]="module"  [7]="kgdb"  [8]="rtc"  [9]="watchdog"  [10]="pnormtd"  [11]="jffs2"  [12]="jffs2_fs"  [13]="strace"  [14]="msh"  [15]="pthread"  [16]="xenomai"  [17]="l1_module"  [18]="l1_app"  [19]="dll"   [20]="sigqueue"  [21]="pound"  [22]="sqlite"   [23]="cfcard" [24]="ide_cdrom"  [25]="nand"  [26]="ad9960"  [27]="oprofile"  [28]="gpio"  [29]="malloc_perf"  [30]="sram_alloc"   [31]="i2ctwi"  [32]="pbx"  [33]="sport"   [34]="erestart"  [35]="null_point"  [36]="mem_fragment"  [37]="dmacopy" [38]="boot_addr" [39]="lmbench" [40]="reserve_mem" [41]="scratchpad_app_stack" [42]="limit_vfssize" [43]="spimmc" [44]="usbhost_bf5xx" [45]="usbnet" [46]="string" [47]="shared_flat" [48]="nbench"  [49]="whetstone" [50]="dhrystone" [51]="usbhost_1362" [52]="usbhost_176x" [53]="mmap" [54]="atapi_hd" [55]="sdiommc"  [56]="linphone_ad1981b" [57]="smbfs" [58]="linphone_ad73322" [59]="mpu" [60]="reprogram_clock" [61]="earlyprintk" [62]="otpmem" [63]="traps" [64]="mplayer" [65]="kgdb_uart" [66]="l2_module" [67]="l2_app" [68]="multichannel" [69]="change_cpufreq" [70]="directfb" [$(( n + 1 ))]="timer"  [$(( n + 2 ))]="ltp"  [$(( n + 3 ))]="audio_ad1836"  [$(( n + 4 ))]="audio_ad73311"  [$(( n + 5 ))]="audio_ad1981b"  [$(( n + 6 ))]="snormtd"  [$(( n + 7 ))]=""  [$(( n + 8 ))]="coreb"  [$(( n + 9 ))]="serial_uart"  [$(( n + 10 ))]="video_adv7393"  [$(( n + 11 ))]="tftlcd" [$(( n + 12 ))]="power" [$(( n + 13 ))]="qt"  [$(( n + 14 ))]="audio_ad1980" [$(( n + 15 ))]="xip" [$(( n + 16 ))]="audio_ad73322" [$(( n + 17 ))]="audio_ssm2602"  )

   AUTO_RUN_STATUS=(  [0]="1"  [1]="1"  [2]="0" [3]="1"  [4]="1"  [5]="1"   [6]="1"  [7]="1"  [8]="1"   [9]="0"   [10]="1"   [11]="1"   [12]="1"     [13]="1" [14]="0"   [15]="1"  [16]="0"    [17]="1"  [18]="1"  [19]="1"  [20]="1"  [21]="1"   [22]="1" [23]="0"   [24]="0"  [25]="0"  [26]="0"  [27]="1"  [28]="1" [29]="1"  [30]="1"   [31]="0"  [32]="0"  [33]="0"  [34]="1" [35]="1" [36]="1" [37]="1" [38]="1" [39]="1" [40]="1" [41]="1" [42]="0" [43]="0" [44]="0" [45]="0" [46]="1" [47]="1"  [48]="1"  [49]="1"  [50]="1"  [51]="0" [52]="0" [53]="1" [54]="0" [55]="0" [56]="0" [57]="0" [58]="0" [59]="0" [60]="1" [61]="1" [62]="0" [63]="1" [64]="0" [65]="0" [66]="0" [67]="0"  [68]="0" [69]="1" [70]="0" [$(( n + 1 ))]="1"  [$(( n + 2 ))]="1"  [$(( n + 3 ))]="0"  [$(( n + 4 ))]="0"  [$(( n + 5 ))]="0"  [$(( n + 6 ))]="0"  [$(( n + 7 ))]="0"  [$(( n + 8 ))]="0" [$(( n + 9 ))]="0" [$(( n + 10 ))]="0" [$(( n + 11 ))]="0" [$(( n + 12 ))]="1" [$(( n + 13 ))]="0" [$(( n + 14 ))]="0" [$(( n + 15 ))]="1" [$(( n + 16 ))]="0" [$(( n + 17 ))]="0"  )

   MANUAL_TESTCASE=( [0]="simple_gpio"  [1]="pfbutton"  [2]="ppifcd"  [3]="joystick"  [4]="ndso"  [5]="awg"  [6]="i2ctwi"  [7]="wireless" [8]="bluetooth"  [9]="bluetoothcf"  [10]="canbus"   [11]="irda"  [12]="usbdev"  [13]="linphone_ad1836"  [14]="sport_uart"  [15]="netaudio" [16]="touchscreen" [17]="microwin" [18]="keypad" [19]="bluetoothalsa" [$(( n + 1 ))]="" [$(( n + 2 ))]="konqueror" )

   MANUAL_RUN_STATUS=( [0]="1"    [1]="1"     [2]="1"    [3]="1"    [4]="1"  [5]="1"  [6]="1"  [7]="1" [8]="1"  [9]="1"  [10]="1"   [11]="1"  [12]="0"  [13]="0"  [14]="1"  [15]="1" [16]="1" [17]="1" [18]="0" [19]="0" [$(( n + 1 ))]="0" [$(( n + 2 ))]="0" )


#################################    BOARD CONFIG DEFINITION    ###################################################### 

if [ $BOARD_CONFIG = "BF537-STAMP-STD" ] ; then

   BOARD_TYPE=BF537-STAMP

   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[26]="1";AUTO_RUN_STATUS[57]="1"; AUTO_RUN_STATUS[$(( n + 3 ))]="1" 
   MANUAL_RUN_STATUS[19]="1"

fi

if [ $BOARD_CONFIG = "BF537-STAMP-USB176x" ] ; then

   BOARD_TYPE=BF537-STAMP

   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[10]="0"; AUTO_RUN_STATUS[11]="0"; AUTO_RUN_STATUS[12]="0"; AUTO_RUN_STATUS[$(( n + 15 ))]="0"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[52]="1";

fi

if [ $BOARD_CONFIG = "BF537-STAMP-MMC" ] ; then

   BOARD_TYPE=BF537-STAMP

   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[11]="0"; AUTO_RUN_STATUS[12]="0"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[43]="1"; AUTO_RUN_STATUS[45]="1"

fi


# Since SW6.4 setting for jffs2(on) and usbhost(off) are conflicting, disable jffs2 test here.
if [ $BOARD_CONFIG = "BF537-STAMP-ADV7393" ] ; then

   BOARD_TYPE=BF537-STAMP

   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[10]="0"; AUTO_RUN_STATUS[11]="0"; AUTO_RUN_STATUS[12]="0"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[51]="1"; AUTO_RUN_STATUS[56]="1"; AUTO_RUN_STATUS[$(( n + 10 ))]="1"
   ##add 1981b test here
   AUTO_RUN_STATUS[$(( n + 5 ))]="1"
   MANUAL_RUN_STATUS[19]="1"

fi


if [ $BOARD_CONFIG = "BF537-STAMP-AD(73311)" ] ; then

   BOARD_TYPE=BF537-STAMP
   
   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[31]="1"; AUTO_RUN_STATUS[33]="1"; AUTO_RUN_STATUS[64]="1"; AUTO_RUN_STATUS[70]="1"; AUTO_RUN_STATUS[$(( n + 4 ))]="1"; AUTO_RUN_STATUS[$(( n + 11 ))]="1"; AUTO_RUN_STATUS[$(( n + 13 ))]="1"; MANUAL_RUN_STATUS[$(( n + 2 ))]="1"

fi


if [ $BOARD_CONFIG = "BF537-STAMP-AD73322" ] ; then

   BOARD_TYPE=BF537-STAMP

   AUTO_RUN_STATUS[11]="0"; AUTO_RUN_STATUS[12]="0"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[58]="1"; AUTO_RUN_STATUS[$(( n + 16 ))]="1"

fi


if [ $BOARD_CONFIG = "BF537-STAMP-MPU" ] ; then

   BOARD_TYPE=BF537-STAMP

   AUTO_RUN_STATUS[11]="0"; AUTO_RUN_STATUS[12]="0"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[59]="1"

fi


if [ $BOARD_CONFIG = "BF537-DIGIUM-PBX" ] ; then
   
   BOARD_TYPE=BF537-STAMP

   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[5]="0"; AUTO_RUN_STATUS[8]="0"; AUTO_RUN_STATUS[10]="0"; AUTO_RUN_STATUS[11]="0"; AUTO_RUN_STATUS[12]="0"; AUTO_RUN_STATUS[13]="0"; AUTO_RUN_STATUS[14]="0"; AUTO_RUN_STATUS[16]="0"; AUTO_RUN_STATUS[20]="0"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[22]="0"; AUTO_RUN_STATUS[27]="0"; AUTO_RUN_STATUS[28]="0"; AUTO_RUN_STATUS[29]="0"; AUTO_RUN_STATUS[34]="0"; AUTO_RUN_STATUS[$(( n + 1 ))]="0"; MANUAL_RUN_STATUS[0]="0"; MANUAL_RUN_STATUS[1]="0"; MANUAL_RUN_STATUS[2]="0"; MANUAL_RUN_STATUS[3]="0"; MANUAL_RUN_STATUS[4]="0"; MANUAL_RUN_STATUS[5]="0"; MANUAL_RUN_STATUS[6]="0"; MANUAL_RUN_STATUS[7]="0"; MANUAL_RUN_STATUS[8]="0"; MANUAL_RUN_STATUS[9]="0"; MANUAL_RUN_STATUS[10]="0"; MANUAL_RUN_STATUS[11]="0"; MANUAL_RUN_STATUS[12]="0"; MANUAL_RUN_STATUS[13]="0"; MANUAL_RUN_STATUS[14]="0"; MANUAL_RUN_STATUS[15]="0"; MANUAL_RUN_STATUS[16]="0"; MANUAL_RUN_STATUS[17]="0"

fi


# Since the SW6 setting for jffs2(all on) and cf card(on on off off) are conflicting, disable jffs2 test here.
if [ $BOARD_CONFIG = "BF537-STAMP-CF" ] ; then

   BOARD_TYPE=BF537-STAMP
   
   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[10]="0"; AUTO_RUN_STATUS[11]="0"; AUTO_RUN_STATUS[12]="0"; AUTO_RUN_STATUS[23]="1"; AUTO_RUN_STATUS[24]="1"; AUTO_RUN_STATUS[25]="1"; AUTO_RUN_STATUS[57]="1" ; AUTO_RUN_STATUS[$(( n + 6 ))]="1"       
fi

if [ $BOARD_CONFIG = "BF537-STAMP-AD9960" ] ; then

   BOARD_TYPE=BF537-STAMP
  
   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[26]="1";AUTO_RUN_STATUS[57]="1";AUTO_RUN_STATUS[65]="1"; AUTO_RUN_STATUS[68]="1"; AUTO_RUN_STATUS[$(( n + 3 ))]="1"; AUTO_RUN_STATUS[$(( n + 9 ))]="1";
   MANUAL_RUN_STATUS[19]="1";
 
fi

# Performance test on BF537-STAMP; BINARY_FORMAT should be set to elf
if [ $BOARD_CONFIG = "BF537-STAMP-PERF" ] ; then

   BOARD_TYPE=BF537-STAMP

   AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[9]="1";  AUTO_RUN_STATUS[21]="0"

fi

if [ $BOARD_CONFIG = "BF533-STAMP-STD" ] ; then

   BOARD_TYPE=BF533-STAMP

   AUTO_RUN_STATUS[57]="1"; AUTO_RUN_STATUS[$(( n + 6 ))]="1"   
   MANUAL_RUN_STATUS[3]="0"; MANUAL_RUN_STATUS[7]="0"; MANUAL_RUN_STATUS[8]="0"; MANUAL_RUN_STATUS[9]="0"; MANUAL_RUN_STATUS[10]="0"; MANUAL_RUN_STATUS[11]="0" 
fi


if [ $BOARD_CONFIG = "BF527-EZKIT-STD" ] ; then

   BOARD_TYPE=BF527-EZKIT

  AUTO_RUN_STATUS[2]="1"; AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[16]="0"; AUTO_RUN_STATUS[25]="1"; AUTO_RUN_STATUS[40]="0"; AUTO_RUN_STATUS[42]="0" ; AUTO_RUN_STATUS[44]="1"; AUTO_RUN_STATUS[45]="0"; AUTO_RUN_STATUS[57]="1"; AUTO_RUN_STATUS[55]="0"; AUTO_RUN_STATUS[62]="1"; AUTO_RUN_STATUS[70]="1"; AUTO_RUN_STATUS[64]="1"; AUTO_RUN_STATUS[$(( n + 6 ))]="1";AUTO_RUN_STATUS[$(( n + 9 ))]="1"; AUTO_RUN_STATUS[$(( n + 11 ))]="1"; AUTO_RUN_STATUS[$(( n + 13 ))]="1"; AUTO_RUN_STATUS[$(( n + 17 ))]="1"

   MANUAL_RUN_STATUS=( [0]="0"    [1]="0"     [2]="0"    [3]="0"    [4]="0"  [5]="0"  [6]="1"  [7]="0" [8]="1"  [9]="0"  [10]="0"   [11]="0"  [12]="1"  [13]="0"  [14]="0"  [15]="0"  [16]="1" [17]="1" [18]="1"  [19]="1"  [$(( n + 1 ))]="0" [$(( n + 2 ))]="1" )

fi


if [ $BOARD_CONFIG = "BF533-EZKIT-STD" ] ; then

   BOARD_TYPE=BF533-EZKIT

   AUTO_RUN_STATUS[10]="0"; AUTO_RUN_STATUS[11]="0"; AUTO_RUN_STATUS[12]="0"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[40]="0"; AUTO_RUN_STATUS[42]="0"; AUTO_RUN_STATUS[57]="1"; 
   
   MANUAL_RUN_STATUS=( [0]="0"    [1]="0"     [2]="0"    [3]="0"    [4]="0"  [5]="0"  [6]="0"  [7]="0" [8]="0"  [9]="0"  [10]="0"   [11]="0"  [12]="0"  [13]="0"  [14]="0"  [15]="0"  [16]="0" [17]="0" [18]="0"   [$(( n + 1 ))]="0"  )
      
fi


if [ $BOARD_CONFIG = "BF548-EZKIT-STD" ] ; then

   BOARD_TYPE=BF548-EZKIT
   
   AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[16]="0"; AUTO_RUN_STATUS[25]="1"; AUTO_RUN_STATUS[40]="0"; AUTO_RUN_STATUS[42]="0" ; AUTO_RUN_STATUS[44]="1"; AUTO_RUN_STATUS[45]="0"; AUTO_RUN_STATUS[54]="1"; AUTO_RUN_STATUS[57]="1"; AUTO_RUN_STATUS[55]="1"; AUTO_RUN_STATUS[62]="1"; AUTO_RUN_STATUS[64]="1"; AUTO_RUN_STATUS[66]="1"; AUTO_RUN_STATUS[67]="1"; AUTO_RUN_STATUS[68]="1"; AUTO_RUN_STATUS[70]="1"; AUTO_RUN_STATUS[$(( n + 6 ))]="1";AUTO_RUN_STATUS[$(( n + 9 ))]="1"; AUTO_RUN_STATUS[$(( n + 11 ))]="1"; AUTO_RUN_STATUS[$(( n + 13 ))]="1"; AUTO_RUN_STATUS[$(( n + 14 ))]="1"

   MANUAL_RUN_STATUS=( [0]="0"    [1]="0"     [2]="0"    [3]="0"    [4]="0"  [5]="0"  [6]="1"  [7]="0" [8]="1"  [9]="0"  [10]="0"   [11]="0"  [12]="1"  [13]="0"  [14]="0"  [15]="0"  [16]="1" [17]="1" [18]="1"  [19]="1"  [$(( n + 1 ))]="0"  [$(( n + 2 ))]="1" )

fi

if [ $BOARD_CONFIG = "BF561-EZKIT-STD" ] ; then

   BOARD_TYPE=BF561-EZKIT

   AUTO_RUN_STATUS[8]="0"; AUTO_RUN_STATUS[9]="1"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[40]="0"; AUTO_RUN_STATUS[42]="0"; AUTO_RUN_STATUS[57]="1"; AUTO_RUN_STATUS[66]="1"; AUTO_RUN_STATUS[67]="1"; AUTO_RUN_STATUS[$(( n + 8 ))]="1"; AUTO_RUN_STATUS[$(( n + 12 ))]="0"

   MANUAL_RUN_STATUS=( [0]="0"    [1]="0"     [2]="0"    [3]="0"    [4]="0"  [5]="0"  [6]="0"  [7]="0" [8]="0"  [9]="0"  [10]="0"   [11]="0"  [12]="0"  [13]="0"  [14]="0"  [15]="0"  [16]="0" [17]="0" [18]="0"   [$(( n + 1 ))]="0" )

fi

if [ $BOARD_CONFIG = "BF561-EZKIT-SMP" ] ; then

   BOARD_TYPE=BF561-EZKIT

   AUTO_RUN_STATUS[8]="0"; AUTO_RUN_STATUS[17]="0"; AUTO_RUN_STATUS[21]="0"; AUTO_RUN_STATUS[40]="0"; AUTO_RUN_STATUS[41]="0"; AUTO_RUN_STATUS[42]="0"; AUTO_RUN_STATUS[57]="1"; AUTO_RUN_STATUS[$(( n + 8 ))]="0"; AUTO_RUN_STATUS[$(( n + 12 ))]="0"

   MANUAL_RUN_STATUS=( [0]="0"    [1]="0"     [2]="0"    [3]="0"    [4]="0"  [5]="0"  [6]="0"  [7]="0" [8]="0"  [9]="0"  [10]="0"   [11]="0"  [12]="0"  [13]="0"  [14]="0"  [15]="0"  [16]="0" [17]="0" [18]="0"   [$(( n + 1 ))]="0" )

fi


if [ $BINARY_FORMAT = "elf" ] ; then

   AUTO_RUN_STATUS[47]="0"; MANUAL_RUN_STATUS[13]="1"
fi


#########################   Build and run the tests     #######################################

export PATH=/opt/uClinux/bfin-uclinux/bin:/opt/uClinux/bfin-elf/bin:/opt/uClinux/bfin-linux-uclibc/bin:$PATH
/opt/uClinux/bfin-uclinux/bin/bfin-uclinux-gcc -v
echo 

cd  $UCLINUX_DIST_TESTSUITES
chmod +x *.exp  */*.exp
cp  $UCLINUX_DIST_TESTSUITES/test_scripts/compare_kernel_results  $UCLINUX_DIST_SCRIPTS/uclinux-dist 
cp  $UCLINUX_DIST_TESTSUITES/test_scripts/get_test_summary  $UCLINUX_DIST_SCRIPTS/uclinux-dist 
cp  $UCLINUX_DIST_TESTSUITES/test_scripts/test_runtime_control  $UCLINUX_DIST_SCRIPTS/uclinux-dist
cp  $UCLINUX_DIST_SCRIPTS/uclinux-dist/reset_board $UCLINUX_DIST_TESTSUITES
cp  $UCLINUX_DIST_SCRIPTS/uclinux-dist/reset_board $UCLINUX_DIST_TESTSUITES/ltp

  #############################################################################################
  ############################ BUILD POLICY UCLINUX_DIST ############################################
if [ $BUILD_POLICY -eq 1  ] ; then
  echo  "Running build policy in uclinux-dist... "
  
  cd $UCLINUX_DIST_TESTSUITES/policy
  ./build_policy_kernel.exp  $BOARD_TYPE $CPU $REVISION $UCLINUX_DIST_PATH $BINARY_FORMAT $ALLOCATOR $ICACHE $DCACHE $POLICY $UART_MODE $SMP $MPU >/dev/null  2>&1
    
  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.policy
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.policy
  cp $UCLINUX_DIST_TESTSUITES/policy/build_policy_kernel_log  $THIS_LOG
  
  if [ ! -f $UCLINUX_DIST_PATH/images/linux ] ; then
  echo  "Linux image fails to be generated.Error!"
  tail -50  ./build_policy_kernel_log
  exit
  fi
      
  sleep 30
  
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi
  
  echo  "cp uclinux-dist source to UCLINUX_DIST_PATH_BAK."
  cp -a $UCLINUX_DIST_PATH $UCLINUX_DIST_PATH_BAK 
  
  sleep 10
fi
  
  #############################################################################################
  ####################            AUTOMATED TESTING             ###############################
  #############################################################################################
 
for i in 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70
do
  if [ ${AUTO_RUN_STATUS[$i]} -eq 1  ] ; then
  
  echo  "Start testing ${AUTO_TESTCASE[$i]}..."

  if [ ${AUTO_TESTCASE[$i]} != "serial" ] &&
     [ ${AUTO_TESTCASE[$i]} != "ethernet" ] &&
     [ ${AUTO_TESTCASE[$i]} != "nfs" ] &&
     [ ${AUTO_TESTCASE[$i]} != "module" ] &&
     [ ${AUTO_TESTCASE[$i]} != "msh" ] &&
     [ ${AUTO_TESTCASE[$i]} != "pound" ] &&
     [ ${AUTO_TESTCASE[$i]} != "cfcard" ] &&
     [ ${AUTO_TESTCASE[$i]} != "sram_alloc" ] &&
     [ ${AUTO_TESTCASE[$i]} != "timer" ] ; then

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE

  fi

  rm -rf romfs/ images/

  if [ ${AUTO_TESTCASE[$i]} == "jffs2_fs" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/jffs2
  elif [ ${AUTO_TESTCASE[$i]} == "ethernet_in_buffer" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/ethernet
  elif [ ${AUTO_TESTCASE[$i]} == "ide_cdrom" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/ide
  elif ([ ${AUTO_TESTCASE[$i]} == "usbhost_1362" ] || [ ${AUTO_TESTCASE[$i]} == "usbhost_176x" ] || [ ${AUTO_TESTCASE[$i]} == "usbhost_bf5xx" ]) ; then
  cd $UCLINUX_DIST_TESTSUITES/usbhost
  elif [ ${AUTO_TESTCASE[$i]} == "atapi_hd" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/atapi
  elif [ ${AUTO_TESTCASE[$i]} == "kgdb_uart" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/kgdb
  elif [ ${AUTO_TESTCASE[$i]} == "linphone_ad1981b" ] || [ ${AUTO_TESTCASE[$i]} == "linphone_ad73322" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/linphone
  else
  cd $UCLINUX_DIST_TESTSUITES/${AUTO_TESTCASE[$i]}    
  fi
 
  if [ ${AUTO_TESTCASE[$i]} == "kgdb_uart" ] ; then 
  ./build_kgdb_kernel.exp $BOARD_TYPE uart >/dev/null  2>&1
  else
  ./build_${AUTO_TESTCASE[$i]}_kernel.exp $BOARD_TYPE  >/dev/null  2>&1
  fi
  if [ ! -f $UCLINUX_DIST_PATH/images/linux ] && [ ${AUTO_TESTCASE[$i]} != "gpio" ] && [ ${AUTO_TESTCASE[$i]} != "jffs2" ]
  then
	echo "$0:   Error, failed."
	tail -50 ./build_${AUTO_TESTCASE[$i]}_kernel_log
  else
 	sleep 30
	if [ ${AUTO_TESTCASE[$i]} == "jffs2" ] || [ ${AUTO_TESTCASE[$i]} == "jffs2_fs" ] ; then	
	  ./flash_images.exp  $BOARD_TYPE  >/dev/null  2>&1
	  sleep 30 
	fi
	
	if [ ${AUTO_TESTCASE[$i]} == "ethernet_in_buffer" ] ; then
	./ethernet_test.exp  $BOARD_TYPE in_buffer >/dev/null  2>&1
        elif [ ${AUTO_TESTCASE[$i]} == "kgdb_uart" ] ; then
	./kgdb_test.exp  $BOARD_TYPE uart >/dev/null  2>&1    
	else
	./${AUTO_TESTCASE[$i]}_test.exp  $BOARD_TYPE >/dev/null  2>&1    
	fi
  
  fi
  
  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.${AUTO_TESTCASE[$i]}
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.${AUTO_TESTCASE[$i]}  
  
  if [ ${AUTO_TESTCASE[$i]} == "jffs2_fs" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/jffs2/*_log  $THIS_LOG
  elif [ ${AUTO_TESTCASE[$i]} == "ethernet_in_buffer" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/ethernet/*_log  $THIS_LOG
  elif [ ${AUTO_TESTCASE[$i]} == "ide_cdrom" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/ide/*_log  $THIS_LOG
  elif ([ ${AUTO_TESTCASE[$i]} == "usbhost_1362" ] || [ ${AUTO_TESTCASE[$i]} == "usbhost_176x" ] || [ ${AUTO_TESTCASE[$i]} == "usbhost_bf5xx" ]) ; then
  cp $UCLINUX_DIST_TESTSUITES/usbhost/*_log  $THIS_LOG
  elif [ ${AUTO_TESTCASE[$i]} == "atapi_hd" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/atapi/*_log  $THIS_LOG
  elif [ ${AUTO_TESTCASE[$i]} == "kgdb_uart" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/kgdb/*_log  $THIS_LOG
  elif [ ${AUTO_TESTCASE[$i]} == "linphone_ad1981b" ] || [ ${AUTO_TESTCASE[$i]} == "linphone_ad73322" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/linphone/*_log  $THIS_LOG
  else
  cp $UCLINUX_DIST_TESTSUITES/${AUTO_TESTCASE[$i]}/*_log  $THIS_LOG   
  fi

  if [ ${AUTO_TESTCASE[$i]} == "cfcard" ] || [ ${AUTO_TESTCASE[$i]} == "ide_cdrom" ] ; then
  cp $UCLINUX_DIST_PATH/images/uImage  $THIS_LOG/uImage.${AUTO_TESTCASE[$i]}
  cp $UCLINUX_DIST_PATH/images/rootfs.ext2  $THIS_LOG/rootfs.ext2.${AUTO_TESTCASE[$i]}  
  fi
   
  if [ ${AUTO_TESTCASE[$i]} == "jffs2" ] ; then
  cp $UCLINUX_DIST_PATH/images/vmImage  $THIS_LOG/vmImage.${AUTO_TESTCASE[$i]}
  cp $UCLINUX_DIST_PATH/images/rootfs.jffs2  $THIS_LOG/rootfs.jffs2.${AUTO_TESTCASE[$i]}  
  
  cd $UCLINUX_DIST_TESTSUITES/${AUTO_TESTCASE[$i]}
  sleep 30
  ./boot_kernel_only_uimage_test.exp  >/dev/null  2>&1
  cp $UCLINUX_DIST_TESTSUITES/${AUTO_TESTCASE[$i]}/boot_kernel_only_uimage_test_log $THIS_LOG

  fi
 
  if [ ${AUTO_TESTCASE[$i]} == "jffs2_fs" ] ; then
  cp $UCLINUX_DIST_PATH/images/vmImage  $THIS_LOG/vmImage.${AUTO_TESTCASE[$i]}
  cp $UCLINUX_DIST_PATH/images/rootfs.jffs2  $THIS_LOG/rootfs.jffs2.${AUTO_TESTCASE[$i]}
  fi
 
  if [ ${AUTO_TESTCASE[$i]} == "kgdb" ] || [ ${AUTO_TESTCASE[$i]} == "kgdb_uart" ] || [ ${AUTO_TESTCASE[$i]} == "spimmc" ] || [ ${AUTO_TESTCASE[$i]} == "sdiommc" ]; then
  cp $UCLINUX_DIST_PATH/linux-2.6.x/vmlinux  $THIS_LOG/vmlinux.${AUTO_TESTCASE[$i]}
  fi

  if [ ${AUTO_TESTCASE[$i]} == "msh" ] || [ ${AUTO_TESTCASE[$i]} == "l1_app" ] || [ ${AUTO_TESTCASE[$i]} == "pthread" ] ; then
  rm -rf $UCLINUX_DIST_PATH/user/busybox
  cd $UCLINUX_DIST_PATH/user 
  cp -a  $UCLINUX_DIST_PATH_BAK/user/busybox  .
  fi

  if [ ${AUTO_TESTCASE[$i]} == "linphone_ad1981b" ] || [ ${AUTO_TESTCASE[$i]} == "linphone_ad73322" ] ; then
  rm -rf $UCLINUX_DIST_PATH/user/linphone
  cd $UCLINUX_DIST_PATH/user
  cp -a  $UCLINUX_DIST_PATH_BAK/user/linphone  .
  fi

  if [ ${AUTO_TESTCASE[$i]} == "shared_flat" ] || [ ${AUTO_TESTCASE[$i]} == "linphone_ad1981b" ] || [ ${AUTO_TESTCASE[$i]} == "linphone_ad73322" ] || [ ${AUTO_TESTCASE[$i]} == "directfb" ]; then
  cd $UCLINUX_DIST_PATH/ 
  make clean > /dev/null 2>&1
  fi

  echo  "End testing ${AUTO_TESTCASE[$i]}..."
  sleep 10
  
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi 
  
  fi
  done
  
  ###############################################################################################
  ########################## TEST TIMER #########################################################
  
 if [ ${AUTO_RUN_STATUS[$(( n + 1 ))]} -eq 1  ] ; then
  echo  "Testing timer..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/ 
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config 
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/
  

  cd $UCLINUX_DIST_TESTSUITES/timer
  ./build_timer_kernel.exp $BOARD_TYPE  100  >/dev/null  2>&1
  sleep 30
  ./timer_tick_test.exp 100 >/dev/null  2>&1
  
  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.timer100 
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.timer100
  
  ./build_timer_kernel.exp $BOARD_TYPE  250  >/dev/null  2>&1
  sleep 30
  ./timer_tick_test.exp 250 >/dev/null  2>&1
  
  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.timer250
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.timer250
    
  ./build_timer_kernel.exp $BOARD_TYPE  1000  >/dev/null  2>&1
  sleep 30
  ./timer_tick_test.exp 1000 >/dev/null  2>&1
  
  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.timer1000
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.timer1000
  cp $UCLINUX_DIST_TESTSUITES/timer/*_log $THIS_LOG
  
  sleep 30

 
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi

  fi


  #############################################################################################
  ########################## TEST VIDEO #########################################################
  if [ ${AUTO_RUN_STATUS[$(( n + 10 ))]} -eq 1  ] ; then
  
  echo  "Testing video adv7393..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/
 
  cd $UCLINUX_DIST_TESTSUITES/video
  ./build_video_kernel.exp $BOARD_TYPE  >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_video_kernel_log
  else
      sleep 30
      ./adv7393_test.exp >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.adv7393
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.adv7393
  cp $UCLINUX_DIST_TESTSUITES/video/build_video_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/video/adv7393_test_log $THIS_LOG/video_adv7393_test_log

  sleep 30
 
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi

  fi

  #############################################################################################
  ###################################### TEST TFTLCD###########################################

  if [ ${AUTO_RUN_STATUS[$(( n + 11 ))]} -eq 1  ] && [ $BOARD_TYPE != "BF537-STAMP" ]; then

  echo  "Testing tftlcd..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_TESTSUITES/tftlcd
  ./build_tftlcd_LQ043_kernel.exp $BOARD_TYPE >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_tftlcd_LQ043_kernel_log
  else
      sleep 30
      ./tftlcd_lq043_test.exp $BOARD_TYPE >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.tftlcd
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.tftlcd
  cp $UCLINUX_DIST_TESTSUITES/tftlcd/build_tftlcd_LQ043_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/tftlcd/tftlcd_lq043_test_log $THIS_LOG

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

  fi


  if [ ${AUTO_RUN_STATUS[$(( n + 11 ))]} -eq 1  ] && [ $BOARD_TYPE == "BF537-STAMP" ] ; then

  echo  "Testing tftlcd landscape..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_TESTSUITES/tftlcd
  ./build_tftlcd_landscape_kernel.exp $BOARD_TYPE >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_tftlcd_landscape_kernel_log
  else
      sleep 30
      ./tftlcd_lq035_test.exp LANDSCAPE >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.tftlcd.landscape
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.tftlcd.landscape
  cp $UCLINUX_DIST_TESTSUITES/tftlcd/build_tftlcd_landscape_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/tftlcd/tftlcd_lq035_test_log $THIS_LOG/tftlcd_lq035_landscape_test_log

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

  echo  "Testing tftlcd portrait..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_TESTSUITES/tftlcd
  ./build_tftlcd_portrait_kernel.exp $BOARD_TYPE  >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_tftlcd_portrait_kernel_log
  else
      sleep 30
      ./tftlcd_lq035_test.exp PORTRAIT >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.tftlcd.portrait
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.tftlcd.portrait
  cp $UCLINUX_DIST_TESTSUITES/tftlcd/build_tftlcd_portrait_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/tftlcd/tftlcd_lq035_test_log $THIS_LOG/tftlcd_lq035_portrait_test_log

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

  fi

  #############################################################################################
  ########################## TEST AUDIO #########################################################
  if [ ${AUTO_RUN_STATUS[$(( n + 3 ))]} -eq 1  ] ; then
  
  echo  "Testing audio ad1836..."
  
  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/audio
  ./build_audio_kernel.exp $BOARD_TYPE audio_ad1836 >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_audio_ad1836_kernel_log
  else
      sleep 30
      ./one_channel_audio_test.exp /dev/ttyS0 >/dev/null  2>&1
      sleep 30
      ./two_channel_audio_test.exp /dev/ttyS0 >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.audio_ad1836
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.audio_ad1836
  cp $UCLINUX_DIST_TESTSUITES/audio/build_audio_ad1836_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/audio/one_channel_audio_test_log $THIS_LOG/one_channel_audio_ad1836_test_log
  cp $UCLINUX_DIST_TESTSUITES/audio/two_channel_audio_test_log $THIS_LOG/two_channel_audio_ad1836_test_log

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  sleep 30
 
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi

  fi
  
  if [ ${AUTO_RUN_STATUS[$(( n + 4 ))]} -eq 1  ] ; then
  
  echo  "Testing audio ad73311..."
 
  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/audio 
  ./build_audio_kernel.exp $BOARD_TYPE audio_ad73311 >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_audio_ad73311_kernel_log
  else
      sleep 30
      ./one_channel_audio_test.exp /dev/ttyS0 >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.audio_ad73311
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.audio_ad73311
  cp $UCLINUX_DIST_TESTSUITES/audio/build_audio_ad73311_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/audio/one_channel_audio_test_log $THIS_LOG/one_channel_audio_ad73311_test_log

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1
 
  sleep 30
 
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi

  fi

  if [ ${AUTO_RUN_STATUS[$(( n + 5 ))]} -eq 1  ] ; then

  echo  "Testing audio ad1981b..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/audio
  ./build_audio_kernel.exp $BOARD_TYPE audio_ad1981b >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_audio_ad1981b_kernel_log
  else
      sleep 30
      ./one_channel_audio_test.exp /dev/ttyS0 >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.audio_ad1981b
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.audio_ad1981b
  cp $UCLINUX_DIST_TESTSUITES/audio/build_audio_ad1981b_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/audio/one_channel_audio_test_log $THIS_LOG/one_channel_audio_ad1981b_test_log

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

  fi


  if [ ${AUTO_RUN_STATUS[$(( n + 14 ))]} -eq 1  ] ; then

  echo  "Testing audio ad1980..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/audio
  ./build_audio_kernel.exp $BOARD_TYPE audio_ad1980 >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_audio_ad1980_kernel_log
  else
      sleep 30
      ./one_channel_audio_test.exp /dev/ttyS0 >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.audio_ad1980
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.audio_ad1980
  cp $UCLINUX_DIST_TESTSUITES/audio/build_audio_ad1980_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/audio/one_channel_audio_test_log $THIS_LOG/one_channel_audio_ad1980_test_log

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  sleep 30


  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

  fi


  if [ ${AUTO_RUN_STATUS[$(( n + 16 ))]} -eq 1  ] ; then

  echo  "Testing audio ad73322..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/audio
  ./build_audio_kernel.exp $BOARD_TYPE audio_ad73322 >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_audio_ad73322_kernel_log
  else
      sleep 30
      ./ad73322_test.exp >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.audio_ad73322
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.audio_ad73322
  cp $UCLINUX_DIST_TESTSUITES/audio/build_audio_ad73322_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/audio/ad73322_test_log $THIS_LOG

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

  fi


  if [ ${AUTO_RUN_STATUS[$(( n + 17 ))]} -eq 1  ] ; then
  
  echo  "Testing audio ssm2602..."
 
  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/audio 
  ./build_audio_kernel.exp $BOARD_TYPE audio_ssm2602 >/dev/null  2>&1


  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_audio_ssm2602_kernel_log
  else
      sleep 30
      ./one_channel_audio_test.exp /dev/ttyS0 >/dev/null  2>&1
  fi


  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.audio_ssm2602
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.audio_ssm2602
  cp $UCLINUX_DIST_TESTSUITES/audio/build_audio_ssm2602_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/audio/one_channel_audio_test_log $THIS_LOG/one_channel_audio_ssm2602_test_log

  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1
 
  sleep 30
 
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

  fi


   #############################################################################################
  ################# TEST BOOT UCLINUX_DIST AND MOUNT JFFS2 FS FROM SPI FLASH ########################

  if [ ${AUTO_RUN_STATUS[$(( n + 6 ))]} -eq 1  ] ; then
  echo  "Testing boot uclinux-dist and mount jffs2 file system from SPI flash ..."
 # Please set the chip selection to the 3rd one on both bf533 and bf537 board.

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/
 
  cd $UCLINUX_DIST_TESTSUITES/snormtd
  ./build_snormtd_kernel.exp $BOARD_TYPE   >/dev/null  2>&1
  sleep 30
  ./spi_flash_images.exp $BOARD_TYPE >/dev/null  2>&1
  if [ $? == 0 ] ; then
  sleep 30
  ./snormtd_reboot_test.exp $BOARD_TYPE >/dev/null  2>&1
  fi
  sleep 30

  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.snormtd
  cp $UCLINUX_DIST_TESTSUITES/snormtd/build_snormtd_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_PATH/images/vmImage $THIS_LOG/vmImage.snormtd
  cp $UCLINUX_DIST_PATH/images/rootfs.jffs2 $THIS_LOG/rootfs.jffs2.snormtd
  cp $UCLINUX_DIST_TESTSUITES/snormtd/spi_flash_images_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/snormtd/snormtd_reboot_test_log $THIS_LOG

    
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi

  cd $UCLINUX_DIST_TESTSUITES/snormtd
  ./build_snormtd_mount_kernel.exp $BOARD_TYPE   >/dev/null  2>&1
  sleep 30
  ./snormtd_test.exp $BOARD_TYPE >/dev/null  2>&1

  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.snormtd_mount
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.snormtd_mount  
  cp $UCLINUX_DIST_TESTSUITES/snormtd/build_snormtd_mount_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/snormtd/snormtd_test_log $THIS_LOG  
  
  sleep 30
 
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi

  fi

  
  ###############################################################################################
  ########################## TEST POWER #########################################################
  
 if [ ${AUTO_RUN_STATUS[$(( n + 12 ))]} -eq 1  ] ; then
  echo  "Testing power..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/ 
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config 
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_PATH/
  make clean > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/power
  ./build_power_kernel.exp $BOARD_TYPE >/dev/null  2>&1
  sleep 30

  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
	echo "$0:   Error, failed."
        tail -50 ./build_power_kernel_log
  else
        if [ ${AUTO_RUN_STATUS[$(( n + 10 ))]} -eq 1  ] ; then
            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_adv7393_test.exp 1 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10

            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_adv7393_test.exp 2 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10
        fi

        if [ ${AUTO_RUN_STATUS[$(( n + 4 ))]} -eq 1  ] ; then
            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ad73311_test.exp 1 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10

            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ad73311_test.exp 2 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10
        fi

        if [ ${AUTO_RUN_STATUS[$(( n + 11 ))]} -eq 1  ] ; then
            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_tftlcd_test.exp $BOARD_TYPE 1 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10

            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_tftlcd_test.exp $BOARD_TYPE 2 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10
        fi

        if [ ${AUTO_RUN_STATUS[$(( n + 3 ))]} -eq 1  ] ; then
            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ad1836_test.exp 1 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10

            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ad1836_test.exp 2 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10
        fi

        if [ ${AUTO_RUN_STATUS[$(( n + 14 ))]} -eq 1  ] ; then
            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ad1980_test.exp 1 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10

            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ad1980_test.exp 2 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10
        fi

        if [ ${AUTO_RUN_STATUS[$(( n + 5 ))]} -eq 1  ] ; then
            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ad1981b_test.exp 1 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10

            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ad1981b_test.exp 2 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10
        fi

        if [ ${AUTO_RUN_STATUS[$(( n + 17 ))]} -eq 1  ] ; then
            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ssm2602_test.exp 1 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10

            cd $UCLINUX_DIST_TESTSUITES/power
            ./power_ssm2602_test.exp 2 >/dev/null  2>&1
            cd $UCLINUX_DIST_TESTSUITES
            ./reset_board.exp  >/dev/null  2>&1
            sleep 10
        fi

        cd $UCLINUX_DIST_TESTSUITES/power
        ./power_ethernet_test.exp 1 >/dev/null  2>&1
        cd $UCLINUX_DIST_TESTSUITES
        ./reset_board.exp  >/dev/null  2>&1
        sleep 10

        cd $UCLINUX_DIST_TESTSUITES/power
        ./power_ethernet_test.exp 2 >/dev/null  2>&1

  fi

  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.power
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.power
  cp $UCLINUX_DIST_TESTSUITES/power/*_log $THIS_LOG

  cd $UCLINUX_DIST_PATH/
  make clean > /dev/null 2>&1

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

 fi


  ###############################################################################################
  ################################## QT #########################################################
  
 if [ ${AUTO_RUN_STATUS[$(( n + 13 ))]} -eq 1  ] ; then
  echo  "Testing qt..."

  echo  "Build qt source..."
  cd $UCLINUX_DIST_TESTSUITES/qt
  ./qt_source_test.exp >/dev/null  2>&1
  if [ ! -f qt_source_test_log ] || [ `grep -c "T[Ee][Ss][Tt] .*\.\.\.\[FAIL]" qt_source_test_log` -gt 0 ] ; then
      echo "$0:   Error, fail."
      tail -50 ./qt_source_test_log
  fi
  mv $UCLINUX_DIST_TESTSUITES/qt/qt_source_test_log $THIS_LOG

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE

  #Build QT kernel and konqueror source of Static FLAT
  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1
  cd $UCLINUX_DIST_TESTSUITES/qt
  ./build_qt_kernel.exp $BOARD_TYPE 1 >/dev/null  2>&1

  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_qt_kernel_log
  else
      sleep 30
      ./qt_test.exp $BOARD_TYPE 1 >/dev/null  2>&1
      if [ ${MANUAL_RUN_STATUS[$(( n + 2 ))]} -eq 1  ] ; then
          echo  "Build konqueror..."
          ./konqueror_kernel_test.exp 1 >/dev/null  2>&1
          sleep 30
          mv $UCLINUX_DIST_TESTSUITES/qt/konqueror_kernel_test_log $THIS_LOG/konqueror_kernel_flat_test_log
      fi
  fi

  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.qt.flat
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.qt.flat
  mv $UCLINUX_DIST_TESTSUITES/qt/build_qt_kernel_log $THIS_LOG/build_qt_flat_kernel_log

  #Build QT kernel and konqueror source of FDPIC
  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/qt
  ./build_qt_kernel.exp $BOARD_TYPE 2 >/dev/null  2>&1

  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
      echo "$0:   Error, failed."
      tail -50 ./build_qt_kernel_log
  else
      sleep 30
      ./qt_test.exp $BOARD_TYPE 2 >/dev/null  2>&1
      if [ ${MANUAL_RUN_STATUS[$(( n + 2 ))]} -eq 1  ] ; then
          echo  "Build konqueror..."
          ./konqueror_kernel_test.exp 2 >/dev/null  2>&1
          sleep 30
          mv $UCLINUX_DIST_TESTSUITES/qt/konqueror_kernel_test_log $THIS_LOG/konqueror_kernel_fdpic_test_log
      fi
  fi

  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.qt.fdpic
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.qt.fdpic
  mv $UCLINUX_DIST_TESTSUITES/qt/build_qt_kernel_log $THIS_LOG/build_qt_fdpic_kernel_log

  cp $UCLINUX_DIST_TESTSUITES/qt/qt_test_log $THIS_LOG
  cd $UCLINUX_DIST_PATH/
  make clean  > /dev/null 2>&1

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi

 fi

  #############################################################################################
  ######################################### TEST XIP###########################################

  if [ ${AUTO_RUN_STATUS[$(( n + 15 ))]} -eq 1  ] ; then

  echo  "Testing xip fdpic..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_PATH/
  make clean > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/xip
  ./build_xip_kernel.exp $BOARD_TYPE fdpic >/dev/null  2>&1
  if [ ! -f $UCLINUX_DIST_PATH/images/linux.romfs ]
  then
	echo "$0:   Error, failed."
	tail -50 ./build_xip_kernel_log
  else
        sleep 30
        ./xip_test.exp $BOARD_TYPE FDPIC >/dev/null  2>&1
  fi

  cp $UCLINUX_DIST_PATH/images/linux.romfs $THIS_LOG/linux.romfs.xip.fdpic
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.xip.fdpic
  mv $UCLINUX_DIST_TESTSUITES/xip/build_xip_kernel_log $THIS_LOG/build_xip_fdpic_kernel_log
  mv $UCLINUX_DIST_TESTSUITES/xip/xip_test_log $THIS_LOG/xip_fdpic_test_log

  #make sure kernel can boot up before next xip test
  cp $THIS_LOG/linux.policy /tftpboot/linux

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi

  echo  "Testing xip shared-flat..."

  cd $UCLINUX_DIST_PATH/
  make clean > /dev/null 2>&1

  cd $UCLINUX_DIST_TESTSUITES/xip
  ./build_xip_kernel.exp $BOARD_TYPE shared-flat >/dev/null  2>&1
  if [ ! -f $UCLINUX_DIST_PATH/images/linux.romfs ]
  then
	echo "$0:   Error, failed."
	tail -50 ./build_xip_kernel_log
  else
        sleep 30
        ./xip_test.exp $BOARD_TYPE SHARED-FLAT >/dev/null  2>&1
  fi

  cp $UCLINUX_DIST_PATH/images/linux.romfs $THIS_LOG/linux.romfs.xip.shared-flat
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.xip.shared-flat
  mv $UCLINUX_DIST_TESTSUITES/xip/build_xip_kernel_log $THIS_LOG/build_xip_shared-flat_kernel_log
  mv $UCLINUX_DIST_TESTSUITES/xip/xip_test_log $THIS_LOG/xip_shared-flat_test_log

  cd $UCLINUX_DIST_PATH/
  make clean > /dev/null 2>&1

  sleep 30

  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1
   sleep 10
  fi


  fi



#############################################################################################
########################## TEST LTP #########################################################

if [ ${AUTO_RUN_STATUS[$(( n + 2 ))]} -eq 1 ] ; then
  echo "Testing LTP..."

  ltp_args=( [0]="1 1" [1]="1 2" [2]="2 1" [3]="2 2" )
  ltp_suf=(wb_slab wb_slob wt_slab wt_slob)

  for i in 0 1 2 3
  do

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/
 
  cd $UCLINUX_DIST_PATH/user/busybox
  make clean  > /dev/null 2>&1

    cd $UCLINUX_DIST_TESTSUITES/ltp
    echo "change dir to $UCLINUX_DIST_TESTSUITES/ltp"

    ./build_ltp_kernel.exp $BOARD_TYPE $UCLINUX_DIST_PATH ${ltp_args[i]}> /dev/null 2>&1
  if [ $? == 1 ] ; then
    echo "ltp build uclinux-dist failed for ${ltp_suf[i]}"
    cp $UCLINUX_DIST_TESTSUITES/ltp/build_ltp_kernel_log $THIS_LOG/build_ltp_kernel_log_${ltp_suf[i]}
    echo "ltp copy build_ltp_kernel_log done"
  else	
    # do if build uclinux-dist succeed
    echo "build_ltp_kernel.exp done"
    sleep 30
    ./ltp_auto_test.exp /dev/ttyS0 2 > /dev/null 2>&1
    echo "ltp_auto_test.exp done"
    ./ltp_compare_results_all.sh config/summary.base $UCLINUX_DIST_TESTSUITES/ltp/test/logs/summary.new >> ltp_test_log
    #./ltp_decide_standard.pl config/summary.base $UCLINUX_DIST_TESTSUITES/ltp/test/logs/summary.new
    if [ $? == 1 ] ; then
      echo "ltp test fail"
      echo "LTP Test ............[FAIL]" >> ltp_test_log
    else
      echo "ltp test pass"
      echo "LTP Test ............[PASS]" >> ltp_test_log
    fi
  
    cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.ltp_${ltp_suf[i]}
    echo "ltp copy linux.ltp done"
    cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.ltp_${ltp_suf[i]}
    echo "ltp copy config.ltp done"
    cp $UCLINUX_DIST_TESTSUITES/ltp/build_ltp_kernel_log $THIS_LOG/build_ltp_kernel_log_${ltp_suf[i]}
    if [ -e $THIS_LOG/build_ltp_kernel_log_${ltp_suf[i]} ]; then
        rm -fr $UCLINUX_DIST_TESTSUITES/ltp/build_ltp_kernel_log
    fi
    echo "ltp copy build_ltp_kernel_log done"
    cp $UCLINUX_DIST_TESTSUITES/ltp/test/logs/summary.new $THIS_LOG/ltp-summary_test_log_${ltp_suf[i]}
    echo "ltp copy summary done"
    cp $UCLINUX_DIST_TESTSUITES/ltp/test/logs/detailed.new $THIS_LOG/ltp-detailed_test_log_${ltp_suf[i]}
    echo "ltp copy detailed done"
    cp $UCLINUX_DIST_TESTSUITES/ltp/build_ltp_log $THIS_LOG/build_ltp_log_${ltp_suf[i]}
    cp $UCLINUX_DIST_TESTSUITES/ltp/ltp_test_log $THIS_LOG/ltp_test_log_${ltp_suf[i]}
    if [ -e $THIS_LOG/ltp_test_log_${ltp_suf[i]} ]; then
        rm $UCLINUX_DIST_TESTSUITES/ltp/ltp_test_log
    fi
    echo "copy log files done"
   
    sleep 30    
   
    if [ $RESET_BOARD -eq 1  ] ; then
     cd $UCLINUX_DIST_TESTSUITES
     ./reset_board.exp   >/dev/null  2>&1       
     sleep 10
    fi
    # end, do if build uclinux-dist succeed
  fi

  cd $UCLINUX_DIST_PATH/user/busybox
  make clean  > /dev/null 2>&1

done

fi


  ###############################################################################################
  ########################## TEST COREB #########################################################
  
 if [ ${AUTO_RUN_STATUS[$(( n + 8 ))]} -eq 1  ] ; then
  echo  "Testing coreb..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  cd $UCLINUX_DIST_TESTSUITES/coreb
  ./build_coreb_kernel.exp $BOARD_TYPE  >/dev/null  2>&1
  sleep 30
  ./coreb_test.exp >/dev/null  2>&1
  
  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.coreb 
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.coreb
  
  cp $UCLINUX_DIST_TESTSUITES/coreb/build_coreb_kernel_log $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/coreb/coreb_test_log $THIS_LOG
  
  sleep 30
 
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
  fi

  fi

  #############################################################################################
  ########################## TEST SERIAL UART1 ################################################  
  
  if [ ${AUTO_RUN_STATUS[$(( n + 9 ))]} -eq 1  ] ; then
  echo  "Testing serial on uart..."
  
  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/
  
  cd  $UCLINUX_DIST_TESTSUITES/serial
  ./build_serial_uart_kernel.exp $BOARD_TYPE  >/dev/null  2>&1
  sleep 30
  ./serial_uart_test.exp $BOARD_TYPE >/dev/null  2>&1
  
  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.serial_uart
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.serial_uart
  cp $UCLINUX_DIST_TESTSUITES/serial/build_serial_uart_kernel_log  $THIS_LOG
  cp $UCLINUX_DIST_TESTSUITES/serial/serial_uart_test_log $THIS_LOG/
  
  sleep 30
    
  if [ $RESET_BOARD -eq 1  ] ; then
   cd $UCLINUX_DIST_TESTSUITES
   ./reset_board.exp  >/dev/null  2>&1 
   sleep 10
   
 fi
 fi

  ################################################################################################
  ###########################          MANUAL TEST          ######################################
  ################################################################################################
    
for i in 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20
  do
  if [ ${MANUAL_RUN_STATUS[$i]} -eq 1  ] ; then
  
  echo  "Start testing ${MANUAL_TESTCASE[$i]}..."

  rm -rf $UCLINUX_DIST_PATH/linux-2.6.x
  cd $UCLINUX_DIST_PATH/
  cp -a  $UCLINUX_DIST_PATH_BAK/linux-2.6.x  .
  cp $UCLINUX_DIST_PATH_BAK/config/.config config
  cp $UCLINUX_DIST_PATH_BAK/vendors/AnalogDevices/$BOARD_TYPE/Makefile vendors/AnalogDevices/$BOARD_TYPE
  rm -rf romfs/ images/

  if [ ${MANUAL_TESTCASE[$i]} == "netaudio" ] ; then
      cd $UCLINUX_DIST_PATH/ 
      make clean > /dev/null 2>&1
  fi

  if [ ${MANUAL_TESTCASE[$i]} == "ndso" ] || [ ${MANUAL_TESTCASE[$i]} == "awg" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/spiadc
  elif [ ${MANUAL_TESTCASE[$i]} == "sport_uart" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/serial
  elif [ ${MANUAL_TESTCASE[$i]} == "linphone_ad1836" ] ; then
  cd $UCLINUX_DIST_TESTSUITES/linphone
  else
  cd $UCLINUX_DIST_TESTSUITES/${MANUAL_TESTCASE[$i]}    
  fi
  
  if [ ${MANUAL_TESTCASE[$i]} == "i2ctwi" ] ; then
  ./build_${MANUAL_TESTCASE[$i]}_keyboard_kernel.exp $BOARD_TYPE  >/dev/null  2>&1 
  sleep 5
  ./build_${MANUAL_TESTCASE[$i]}_lcd_kernel.exp $BOARD_TYPE  >/dev/null  2>&1 
  else
  ./build_${MANUAL_TESTCASE[$i]}_kernel.exp $BOARD_TYPE  >/dev/null  2>&1  
  fi

  if [ ! -f $UCLINUX_DIST_PATH/images/linux ]
  then
        echo "$0:       Error, failed."
	tail -50 ./build_${MANUAL_TESTCASE[$i]}_kernel_log
  fi
  
  cp $UCLINUX_DIST_PATH/images/linux $THIS_LOG/linux.${MANUAL_TESTCASE[$i]}
  cp $UCLINUX_DIST_PATH/linux-2.6.x/.config $THIS_LOG/config.${MANUAL_TESTCASE[$i]}
  
  if [ ${MANUAL_TESTCASE[$i]} == "ndso" ] || [ ${MANUAL_TESTCASE[$i]} == "awg" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/spiadc/*_log  $THIS_LOG
  elif [ ${MANUAL_TESTCASE[$i]} == "sport_uart" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/serial/*_log  $THIS_LOG
  elif [ ${MANUAL_TESTCASE[$i]} == "linphone_ad1836" ] ; then
  cp $UCLINUX_DIST_TESTSUITES/linphone/*_log  $THIS_LOG
  else
  cp $UCLINUX_DIST_TESTSUITES/${MANUAL_TESTCASE[$i]}/*_log  $THIS_LOG   
  fi
    
  if [ ${MANUAL_TESTCASE[$i]} == "netaudio" ] || [ ${MANUAL_TESTCASE[$i]} == "linphone_ad1836" ] || [ ${MANUAL_TESTCASE[$i]} == "microwin" ] || [ ${MANUAL_TESTCASE[$i]} == "bluetoothalsa" ] ; then
      cd $UCLINUX_DIST_PATH/ 
      make clean > /dev/null 2>&1
  fi

  echo  "End testing ${MANUAL_TESTCASE[$i]}..."
  fi
  done
  
   
 
 echo  "Testing Done."
